{
  "version": 3,
  "sources": ["../../music-metadata/lib/id3v2/AbstractID3Parser.js"],
  "sourcesContent": ["import { EndOfStreamError } from 'strtok3';\nimport initDebug from 'debug';\nimport { ID3v2Header } from './ID3v2Token.js';\nimport { ID3v2Parser } from './ID3v2Parser.js';\nimport { ID3v1Parser } from '../id3v1/ID3v1Parser.js';\nimport { BasicParser } from '../common/BasicParser.js';\nconst debug = initDebug('music-metadata:parser:ID3');\n/**\n * Abstract parser which tries take ID3v2 and ID3v1 headers.\n */\nexport class AbstractID3Parser extends BasicParser {\n    constructor() {\n        super(...arguments);\n        this.id3parser = new ID3v2Parser();\n    }\n    static async startsWithID3v2Header(tokenizer) {\n        return (await tokenizer.peekToken(ID3v2Header)).fileIdentifier === 'ID3';\n    }\n    async parse() {\n        try {\n            await this.parseID3v2();\n        }\n        catch (err) {\n            if (err instanceof EndOfStreamError) {\n                debug(\"End-of-stream\");\n            }\n            else {\n                throw err;\n            }\n        }\n    }\n    finalize() {\n        return;\n    }\n    async parseID3v2() {\n        await this.tryReadId3v2Headers();\n        debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);\n        await this.postId3v2Parse();\n        if (this.options.skipPostHeaders && this.metadata.hasAny()) {\n            this.finalize();\n        }\n        else {\n            const id3v1parser = new ID3v1Parser(this.metadata, this.tokenizer, this.options);\n            await id3v1parser.parse();\n            this.finalize();\n        }\n    }\n    async tryReadId3v2Headers() {\n        const id3Header = await this.tokenizer.peekToken(ID3v2Header);\n        if (id3Header.fileIdentifier === 'ID3') {\n            debug('Found ID3v2 header, pos=%s', this.tokenizer.position);\n            await this.id3parser.parse(this.metadata, this.tokenizer, this.options);\n            return this.tryReadId3v2Headers();\n        }\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AACA,mBAAsB;AAKtB,IAAM,YAAQ,aAAAA,SAAU,2BAA2B;AAI5C,IAAM,oBAAN,cAAgC,YAAY;AAAA,EAC/C,cAAc;AACV,UAAM,GAAG,SAAS;AAClB,SAAK,YAAY,IAAI,YAAY;AAAA,EACrC;AAAA,EACA,aAAa,sBAAsB,WAAW;AAC1C,YAAQ,MAAM,UAAU,UAAU,WAAW,GAAG,mBAAmB;AAAA,EACvE;AAAA,EACA,MAAM,QAAQ;AACV,QAAI;AACA,YAAM,KAAK,WAAW;AAAA,IAC1B,SACO,KAAK;AACR,UAAI,eAAe,kBAAkB;AACjC,cAAM,eAAe;AAAA,MACzB,OACK;AACD,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,WAAW;AACP;AAAA,EACJ;AAAA,EACA,MAAM,aAAa;AACf,UAAM,KAAK,oBAAoB;AAC/B,UAAM,kDAAkD,KAAK,UAAU,QAAQ;AAC/E,UAAM,KAAK,eAAe;AAC1B,QAAI,KAAK,QAAQ,mBAAmB,KAAK,SAAS,OAAO,GAAG;AACxD,WAAK,SAAS;AAAA,IAClB,OACK;AACD,YAAM,cAAc,IAAI,YAAY,KAAK,UAAU,KAAK,WAAW,KAAK,OAAO;AAC/E,YAAM,YAAY,MAAM;AACxB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AAAA,EACA,MAAM,sBAAsB;AACxB,UAAM,YAAY,MAAM,KAAK,UAAU,UAAU,WAAW;AAC5D,QAAI,UAAU,mBAAmB,OAAO;AACpC,YAAM,8BAA8B,KAAK,UAAU,QAAQ;AAC3D,YAAM,KAAK,UAAU,MAAM,KAAK,UAAU,KAAK,WAAW,KAAK,OAAO;AACtE,aAAO,KAAK,oBAAoB;AAAA,IACpC;AAAA,EACJ;AACJ;",
  "names": ["initDebug"]
}
